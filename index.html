<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bread N' Brew - Berkeley Heights</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      body {
        font-family: "Roboto", sans-serif;
        scroll-behavior: smooth;
      }
      h1,
      h2,
      h3,
      h4,
      .font-display {
        font-family: "Playfair Display", serif;
      }
      .hero-bg {
        background-image:
          linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
          url("https://images.unsplash.com/photo-1497935586351-b67a49e012bf?q=80&w=2071&auto=format&fit=crop");
        background-size: cover;
        background-position: center;
      }
      .menu-item-img,
      .gallery-img {
        aspect-ratio: 1 / 1;
        object-fit: cover;
      }
      .cart {
        transition: transform 0.3s ease-in-out;
      }
      .cart-hidden {
        transform: translateX(110%);
      }
      .floating-cart-btn {
        transition:
          transform 0.3s ease-in-out,
          opacity 0.3s ease-in-out;
        transform: scale(0);
        opacity: 0;
      }
      .floating-cart-btn.visible {
        transform: scale(1);
        opacity: 1;
      }
      .toast-wrapper {
        transition:
          opacity 0.5s ease-in-out,
          transform 0.5s ease-in-out;
        transform: translateY(200%);
        opacity: 0;
        pointer-events: none;
      }
      .toast-wrapper.visible {
        transform: translateY(0);
        opacity: 1;
      }
      .time-slot-btn.selected,
      .filter-btn.selected,
      .custom-btn.selected,
      .tip-btn.selected {
        background-color: #78350f; /* amber-900 */
        color: white;
        border-color: #78350f;
      }

      /* Mobile menu improvements */
      .mobile-menu-transition {
        transition:
          max-height 0.3s ease-in-out,
          opacity 0.3s ease-in-out;
        overflow: hidden;
      }

      .mobile-menu-hidden {
        max-height: 0;
        opacity: 0;
      }

      .mobile-menu-visible {
        max-height: 300px;
        opacity: 1;
      }

      /* Filter tabs mobile improvements */
      .filter-container {
        scrollbar-width: none;
        -ms-overflow-style: none;
      }

      .filter-container::-webkit-scrollbar {
        display: none;
      }

      /* Ensure proper touch targets */
      .touch-target {
        min-height: 44px;
        min-width: 44px;
      }

      /* Cart mobile improvements */
      @media (max-width: 768px) {
        .cart {
          max-width: 100% !important;
          width: 100% !important;
        }

        .filter-btn {
          flex-shrink: 0;
          min-width: max-content;
          padding: 0.5rem 1rem;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <!-- Header & Navigation -->
    <header
      id="header"
      class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300"
    >
      <nav
        class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex justify-between items-center"
      >
        <a
          href="#"
          class="text-2xl sm:text-3xl font-bold text-pink-500 font-display"
        >
          <div>
            Bread N' Br☕︎w
            <span
              class="hidden sm:block text-xs font-normal text-gray-500 tracking-wider"
              >Artisan Breads, Perfect Brews, & Fine Patisseries</span
            >
          </div>
        </a>
        <div class="hidden md:flex items-center space-x-8">
          <a
            href="#menu"
            class="text-gray-600 hover:text-pink-500 transition text-lg"
            >Menu</a
          >
          <a
            href="#catering"
            class="text-gray-600 hover:text-pink-500 transition text-lg"
            >Catering</a
          >
          <a
            href="#location"
            class="text-gray-600 hover:text-pink-500 transition text-lg"
            >Location</a
          >
          <a
            href="#menu"
            class="hidden lg:inline-block bg-pink-500 text-white font-bold py-2 px-6 rounded-full hover:bg-pink-600 transition"
            >Order Online</a
          >
        </div>
        <button
          id="mobile-menu-button"
          class="md:hidden touch-target flex items-center justify-center"
        >
          <i data-lucide="menu" class="w-6 h-6"></i>
        </button>
      </nav>
      <!-- Mobile Menu -->
      <div
        id="mobile-menu"
        class="mobile-menu-transition mobile-menu-hidden md:hidden"
      >
        <div class="px-4 sm:px-6 pb-4 space-y-2">
          <a
            href="#menu"
            class="block py-3 text-gray-600 hover:text-pink-500 text-lg touch-target"
            >Menu</a
          >
          <a
            href="#catering"
            class="block py-3 text-gray-600 hover:text-pink-500 text-lg touch-target"
            >Catering</a
          >
          <a
            href="#location"
            class="block py-3 text-gray-600 hover:text-pink-500 text-lg touch-target"
            >Location</a
          >
          <a
            href="#menu"
            class="block mt-4 bg-pink-500 text-white font-bold py-3 px-6 rounded-full text-center hover:bg-pink-600 transition touch-target"
            >Order Online</a
          >
        </div>
      </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-bg text-white h-[60vh] sm:h-[70vh] flex items-center">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center">
        <h1
          class="text-3xl sm:text-5xl md:text-6xl lg:text-7xl font-bold mb-4 drop-shadow-lg"
        >
          Perfect Brews, Fine Patisseries
        </h1>
        <p class="text-lg sm:text-xl md:text-2xl max-w-3xl mx-auto mb-8">
          Freshly baked pastries and specialty coffee in the heart of Berkeley
          Heights.
        </p>
        <a
          href="#menu"
          class="bg-white text-amber-800 font-bold py-3 px-6 sm:px-8 rounded-full text-base sm:text-lg hover:bg-gray-200 transition touch-target inline-block"
          >Start Your Order</a
        >
      </div>
    </section>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-12 lg:py-20">
      <!-- Menu Section -->
      <section id="menu" class="my-8 sm:my-16">
        <h2
          class="text-3xl sm:text-4xl lg:text-5xl font-bold text-center mb-4 font-display"
        >
          Our Menu
        </h2>

        <!-- Menu Filters & Search -->
        <div
          class="flex flex-col gap-4 items-stretch mb-8 sm:mb-12 sticky top-[88px] bg-gray-100 py-4 z-30"
        >
          <div class="relative w-full">
            <input
              type="text"
              id="search-bar"
              placeholder="Search for an item..."
              class="w-full pl-10 pr-4 py-3 border rounded-full focus:outline-none focus:ring-2 focus:ring-amber-600 text-base"
            />
            <i
              data-lucide="search"
              class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"
            ></i>
          </div>
          <div
            id="filter-container"
            class="filter-container flex flex-wrap gap-2 pb-2"
          >
            <!-- Filter buttons will be generated by JS -->
          </div>
        </div>

        <div
          id="menu-grid"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 lg:gap-8"
        >
          <!-- Menu items will be generated here by JS -->
        </div>
      </section>

      <!-- Catering Section -->
      <section id="catering" class="my-16 sm:my-24">
        <div class="grid md:grid-cols-2 gap-8 lg:gap-16 items-center">
          <div>
            <h2
              class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-6 font-display"
            >
              Catering for Any Event
            </h2>
            <p class="text-lg sm:text-xl text-gray-600 mb-6">
              Bring the taste of Bread N' Brew to your next meeting, party, or
              special event. We offer customizable platters of our finest
              pastries, breads, and coffee service.
            </p>
            <p class="text-base sm:text-lg text-gray-600">
              Fill out the form to get started, and our catering specialist will
              get in touch with you shortly.
            </p>
          </div>
          <div class="bg-white p-6 sm:p-10 rounded-lg shadow-lg">
            <form id="catering-form">
              <div class="mb-4">
                <label for="name" class="block text-gray-700 font-bold mb-2"
                  >Full Name</label
                >
                <input
                  type="text"
                  id="name"
                  name="name"
                  class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600 text-base sm:text-lg"
                  required
                />
              </div>
              <div class="mb-4">
                <label for="email" class="block text-gray-700 font-bold mb-2"
                  >Email</label
                >
                <input
                  type="email"
                  id="email"
                  name="email"
                  class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600 text-base sm:text-lg"
                  required
                />
              </div>
              <div class="mb-4">
                <label for="date" class="block text-gray-700 font-bold mb-2"
                  >Event Date</label
                >
                <input
                  type="date"
                  id="date"
                  name="date"
                  class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600 text-base sm:text-lg"
                  required
                />
              </div>
              <div class="mb-6">
                <label for="message" class="block text-gray-700 font-bold mb-2"
                  >Tell Us About Your Event</label
                >
                <textarea
                  id="message"
                  name="message"
                  rows="4"
                  class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600 text-base sm:text-lg"
                  required
                ></textarea>
              </div>
              <button
                type="submit"
                class="w-full bg-amber-800 text-white font-bold py-3 px-6 rounded-full hover:bg-amber-900 transition text-lg sm:text-xl touch-target"
              >
                Submit Inquiry
              </button>
            </form>
          </div>
        </div>
      </section>

      <!-- Customer Reviews -->
      <section id="reviews" class="my-16 sm:my-24">
        <h2
          class="text-3xl sm:text-4xl lg:text-5xl font-bold text-center mb-8 sm:mb-16 font-display"
        >
          What Our Customers Are Saying
        </h2>
        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8"
        >
          <div class="bg-white p-6 sm:p-8 rounded-lg shadow-lg">
            <div class="flex items-center mb-4 text-yellow-500">
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
            </div>
            <p class="text-gray-600 italic mb-4">"Review System to be Added"</p>
            <p class="font-bold text-amber-800">- Developer</p>
          </div>
          <div class="bg-white p-6 sm:p-8 rounded-lg shadow-lg">
            <div class="flex items-center mb-4 text-yellow-500">
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
            </div>
            <p class="text-gray-600 italic mb-4">"Review System to be Added"</p>
            <p class="font-bold text-amber-800">- Developer</p>
          </div>
          <div class="bg-white p-6 sm:p-8 rounded-lg shadow-lg">
            <div class="flex items-center mb-4 text-yellow-500">
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
              <i data-lucide="star" class="w-5 h-5 fill-current"></i>
            </div>
            <p class="text-gray-600 italic mb-4">"Review System to be Added"</p>
            <p class="font-bold text-amber-800">- Developer</p>
          </div>
        </div>
      </section>

      <!-- Photo Gallery -->
      <section id="gallery" class="my-16 sm:my-24">
        <h2
          class="text-3xl sm:text-4xl lg:text-5xl font-bold text-center mb-8 sm:mb-16 font-display"
        >
          A Glimpse Inside
        </h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="grid gap-4">
            <div>
              <img
                class="h-auto max-w-full rounded-lg shadow-lg transform hover:scale-105 transition-transform"
                src="UPDATE WHEN IMAGE"
                alt="Cafe interior"
              />
            </div>
            <div>
              <img
                class="h-auto max-w-full rounded-lg shadow-lg transform hover:scale-105 transition-transform"
                src="UPDATE WHEN IMAGE"
                alt="Latte art close-up"
              />
            </div>
          </div>
          <div class="grid gap-4">
            <div>
              <img
                class="h-auto max-w-full rounded-lg shadow-lg transform hover:scale-105 transition-transform"
                src="UPDATE WHEN IMAGE"
                alt="Coffee beans"
              />
            </div>
            <div>
              <img
                class="h-auto max-w-full rounded-lg shadow-lg transform hover:scale-105 transition-transform"
                src="UPDATE WHEN IMAGE"
                alt="Pastry display case"
              />
            </div>
          </div>
          <div class="grid gap-4">
            <div>
              <img
                class="h-auto max-w-full rounded-lg shadow-lg transform hover:scale-105 transition-transform"
                src="UPDATE WHEN IMAGE"
                alt="Barista making coffee"
              />
            </div>
            <div>
              <img
                class="h-auto max-w-full rounded-lg shadow-lg transform hover:scale-105 transition-transform"
                src="UPDATE WHEN IMAGE"
                alt="Loaf of bread"
              />
            </div>
          </div>
          <div class="grid gap-4">
            <div>
              <img
                class="h-auto max-w-full rounded-lg shadow-lg transform hover:scale-105 transition-transform"
                src="UPDATE WHEN IMAGE"
                alt="Customers enjoying coffee"
              />
            </div>
            <div>
              <img
                class="h-auto max-w-full rounded-lg shadow-lg transform hover:scale-105 transition-transform"
                src="UPDATE WHEN IMAGE"
                alt="Espresso machine"
              />
            </div>
          </div>
        </div>
      </section>

      <!-- Location Section -->
      <section id="location" class="my-16 sm:my-24">
        <h2
          class="text-3xl sm:text-4xl lg:text-5xl font-bold text-center mb-8 sm:mb-16 font-display"
        >
          Visit Us
        </h2>
        <div class="grid md:grid-cols-2 gap-8 lg:gap-16">
          <div class="rounded-lg overflow-hidden shadow-lg h-full">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3026.471988894957!2d-74.3808189845963!3d40.66360327933718!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c3b88b0b54131b%3A0x5f3f0e1f0e2d3d3!2s512%20Springfield%20Ave%2C%20Berkeley%20Heights%2C%20NJ%2007922!5e0!3m2!1sen!2sus!4v1626815320508!5m2!1sen!2sus"
              width="100%"
              height="100%"
              style="border: 0; min-height: 350px"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
            ></iframe>
          </div>
          <div
            class="bg-white p-6 sm:p-10 rounded-lg shadow-lg flex flex-col justify-center"
          >
            <h3
              class="text-2xl sm:text-3xl lg:text-4xl font-bold font-display mb-6"
            >
              Contact & Hours
            </h3>
            <div
              class="text-lg sm:text-xl text-gray-700 mb-6 flex flex-col space-y-4"
            >
              <a
                href="tel:908-933-0123"
                class="flex items-center hover:text-amber-800 touch-target"
              >
                <i
                  data-lucide="phone"
                  class="w-6 h-6 mr-4 text-amber-800 flex-shrink-0"
                ></i>
                <span>(908) 933-0123</span>
              </a>
              <a
                href="mailto:breadnbrew512@gmail.com"
                class="flex items-center hover:text-amber-800 touch-target"
              >
                <i
                  data-lucide="mail"
                  class="w-6 h-6 mr-4 text-amber-800 flex-shrink-0"
                ></i>
                <span>breadnbrew512@gmail.com</span>
              </a>
              <a
                href="https://www.google.com/maps/place/512+Springfield+Ave,+Berkeley+Heights,+NJ+07922/@40.6833573,-74.4471183,17z/data=!3m1!4b1!4m6!3m5!1s0x89c3badcdf66fd51:0x96ba1541f304b640!8m2!3d40.6833533!4d-74.4422474!16s%2Fg%2F11f4ln2ss9?entry=ttu&g_ep=EgoyMDI1MDYxMS4wIKXMDSoASAFQAw%3D%3D"
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-start hover:text-amber-800 touch-target"
              >
                <i
                  data-lucide="map-pin"
                  class="w-6 h-6 mr-4 text-amber-800 flex-shrink-0 mt-1"
                ></i>
                <span>512 Springfield Ave<br />Berkeley Heights, NJ 07922</span>
              </a>
            </div>
            <div class="text-lg sm:text-xl text-gray-700 flex items-start">
              <i
                data-lucide="clock"
                class="w-6 h-6 mr-4 mt-1 text-amber-800 flex-shrink-0"
              ></i>
              <div>
                <p class="mb-2"><span class="font-bold">Hours:</span> TBD</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center">
        <div class="flex justify-center space-x-6 mb-4">
          <a
            href="#"
            class="text-gray-400 hover:text-white touch-target flex items-center justify-center"
            ><i data-lucide="instagram" class="w-7 h-7"></i
          ></a>
          <a
            href="#"
            class="text-gray-400 hover:text-white touch-target flex items-center justify-center"
            ><i data-lucide="facebook" class="w-7 h-7"></i
          ></a>
          <a
            href="#"
            class="text-gray-400 hover:text-white touch-target flex items-center justify-center"
            ><i data-lucide="twitter" class="w-7 h-7"></i
          ></a>
        </div>
        <p class="font-display text-xl sm:text-2xl mb-2">Bread N' Br☕︎w</p>
        <p>&copy; 2025. All Rights Reserved.</p>
      </div>
    </footer>

    <!-- Floating Cart Button -->
    <button
      id="floating-cart-btn"
      class="floating-cart-btn fixed bottom-4 sm:bottom-6 right-4 sm:right-6 bg-amber-800 text-white w-14 h-14 sm:w-16 sm:h-16 rounded-full shadow-lg flex items-center justify-center z-40 touch-target"
    >
      <i data-lucide="shopping-cart" class="w-6 h-6 sm:w-8 sm:h-8"></i>
      <span
        id="cart-item-count"
        class="absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full h-5 w-5 sm:h-6 sm:w-6 flex items-center justify-center font-bold"
        >0</span
      >
    </button>

    <!-- Shopping Cart -->
    <div
      id="cart"
      class="cart cart-hidden fixed right-0 top-0 h-full w-full sm:max-w-md bg-white shadow-2xl z-50 flex flex-col"
    >
      <!-- Cart will be rendered here by JS -->
    </div>

    <!-- "Added to Cart" Toast Notification -->
    <div
      id="toast-wrapper"
      class="toast-wrapper fixed bottom-20 sm:bottom-6 left-4 right-4 sm:left-0 sm:right-0 text-center z-50"
    >
      <div
        id="toast-message"
        class="inline-block bg-gray-900 text-white py-3 px-6 rounded-full shadow-lg"
      >
        Item added to your cart!
      </div>
    </div>

    <!-- Custom Modal for Alerts and Customizations -->
    <div
      id="custom-modal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4"
    >
      <div
        class="bg-white p-6 sm:p-8 rounded-lg shadow-xl text-center max-w-sm mx-auto w-full"
      >
        <div id="modal-content">
          <h3
            id="modal-title"
            class="text-xl sm:text-2xl font-bold mb-4 font-display"
          >
            Alert
          </h3>
          <div id="modal-body" class="text-gray-700 mb-6">Message here.</div>
          <div id="modal-actions">
            <button
              class="modal-close-btn bg-amber-800 text-white font-bold py-2 px-8 rounded-full touch-target"
            >
              OK
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // --- DATA ---
      const menuItems = [
        // Pastries
        {
          id: 1,
          name: "Butter Croissant",
          price: 4.5,
          category: "Pastries",
          img: "https://media.discordapp.net/attachments/1141574690025001060/1383691220668252201/crossiant.jpg?ex=684fb65e&is=684e64de&hm=5bdd4b747ef554c8039517f54f3c72ace18fe91a36bd6bd043c9c7f8e8a61954&=&format=webp&width=704&height=704",
          description:
            "Flaky, buttery, and baked to golden perfection. A classic favorite.",
          allergens: ["Wheat", "Dairy", "Eggs"],
          customizations: { toast: ["Untoasted", "Toasted"] },
        },
        {
          id: 3,
          name: "Cinnamon Bun",
          price: 5.5,
          category: "Pastries",
          img: "https://media.discordapp.net/attachments/1141574690025001060/1383691219783254066/cinnamon.jpg?ex=684fb65e&is=684e64de&hm=438a302406c57b668859321e0e0e2aaa50b3962de71d79603c26bc119f3f47cf&=&format=webp&width=704&height=704",
          description:
            "Sweet, gooey, and topped with a decadent cream cheese frosting.",
          allergens: ["Wheat", "Dairy", "Eggs"],
          customizations: { toast: ["Untoasted", "Toasted"] },
        },
        {
          id: 4,
          name: "Chocolate Muffin",
          price: 4.0,
          category: "Pastries",
          img: "https://media.discordapp.net/attachments/1141574690025001060/1383691219531599902/chocolate.jpg?ex=684fb65e&is=684e64de&hm=2865dad7a85b970cf99605477b589d374dc048d0b39bff9d05ad8c4fdedd9c92&=&format=webp&width=704&height=704",
          description:
            "A rich, moist chocolate muffin packed with semi-sweet chocolate chips.",
          allergens: ["Wheat", "Dairy", "Eggs", "Soy"],
        },
        {
          id: 9,
          name: "Almond Croissant",
          price: 5.25,
          category: "Pastries",
          img: "https://i.ibb.co/gZQQBFX/Almondcros.jpg",
          description:
            "Filled with a sweet almond paste and topped with toasted almonds.",
          allergens: ["Wheat", "Dairy", "Eggs", "Tree Nuts"],
          customizations: { toast: ["Untoasted", "Toasted"] },
        },
        {
          id: 10,
          name: "Pain au Chocolat",
          price: 5.0,
          category: "Pastries",
          img: "https://i.ibb.co/rRrTXJm/Painauchocolat.jpg",
          description:
            "A classic French pastry with two sticks of dark chocolate.",
          allergens: ["Wheat", "Dairy", "Eggs", "Soy"],
          customizations: { toast: ["Untoasted", "Toasted"] },
        },
        {
          id: 11,
          name: "Blueberry Scone",
          price: 4.25,
          category: "Pastries",
          img: "https://i.ibb.co/bgz2DNx/blueberry.jpg",
          description:
            "A tender, crumbly scone bursting with fresh blueberries.",
          allergens: ["Wheat", "Dairy", "Eggs"],
        },
        // Breads
        {
          id: 2,
          name: "Sourdough",
          price: 17.0,
          category: "Breads",
          img: "https://media.discordapp.net/attachments/1141574690025001060/1383691220106350642/sourdough.jpg?ex=684fb65e&is=684e64de&hm=5e7fefbfba4465f47dd23f13d8bda91a98f0673be367755d64d8dabdf45e635e&=&format=webp&width=704&height=704",
          description:
            "Our signature loaf with a crispy crust and a soft, chewy interior.",
          allergens: ["Wheat"],
          customizations: {
            slice: [
              { name: "Loaf", price: 0 },
              { name: "Slice", price: -14.5 },
            ],
          },
        },
        // Brews & Coffee
        {
          id: 5,
          name: "Artisan Latte",
          price: 5.0,
          category: "Coffee",
          img: "https://media.discordapp.net/attachments/1141574690025001060/1383691219153981512/artisan.jpg?ex=684fb65e&is=684e64de&hm=438a32e3463de1c3c9dd9732fa1462e9f5797393669ffcbbe1639f464aa6c41f&=&format=webp&width=704&height=704",
          description:
            "Rich espresso with perfectly steamed milk and a touch of latte art.",
          allergens: ["Dairy"],
        },
        {
          id: 6,
          name: "Signature Cold Brew",
          price: 5.25,
          category: "Coffee",
          img: "https://media.discordapp.net/attachments/1141574690025001060/1383691218890002533/coldbrew.jpg?ex=684fb65e&is=684e64de&hm=4bbf54e70fc6f307e5ae4ccfc1a3761d365de941f7bf9d9e4df79992b10c4a82&=&format=webp&width=704&height=704",
          description:
            "Slow-steeped for 18 hours for a smooth, bold, and refreshing taste.",
          allergens: [],
        },
        {
          id: 7,
          name: "Classic Cappuccino",
          price: 4.75,
          category: "Coffee",
          img: "https://media.discordapp.net/attachments/1141574690025001060/1383691218537545839/cappucino.jpg?ex=684fb65e&is=684e64de&hm=f8b3ea4b02483ea0149d66c4c11f88bd159f512720b6b567eb847d3dca900264&=&format=webp&width=704&height=704",
          description:
            "A perfect balance of espresso, steamed milk, and a thick layer of foam.",
          allergens: ["Dairy"],
        },
        {
          id: 8,
          name: "Americano",
          price: 3.75,
          category: "Coffee",
          img: "https://media.discordapp.net/attachments/1141574690025001060/1383691218260852766/esperro.jpg?ex=684fb65e&is=684e64de&hm=a0aa94dc266e87bb0a6255100358110652ac8035ad70677920838556aaae4b8c&=&format=webp&width=704&height=704",
          description:
            "A shot of our signature espresso, softened with hot water.",
          allergens: [],
        },
        // Sweets
        {
          id: 25,
          name: "Cake Pop",
          price: 3.0,
          category: "Sweets",
          img: "https://i.ibb.co/C51QZ50/Cakepop.jpg",
          description:
            "A bite-sized treat of vanilla or chocolate cake dipped in icing.",
          allergens: ["Wheat", "Dairy", "Eggs", "Soy"],
        },
        {
          id: 26,
          name: "Assorted Macarons",
          price: 3.5,
          category: "Sweets",
          img: "https://i.ibb.co/VpgsSqM/Macarons.jpg",
          description: "Delicate French almond cookies. Flavors change daily.",
          allergens: ["Tree Nuts", "Dairy", "Eggs"],
        },
        {
          id: 27,
          name: "Cannoli",
          price: 4.5,
          category: "Sweets",
          img: "https://i.ibb.co/Rkg5z02/Cannoli.jpg",
          description:
            "A crispy pastry shell filled with a sweet, creamy ricotta filling.",
          allergens: ["Wheat", "Dairy", "Eggs"],
        },
        // Tea
        {
          id: 12,
          name: "Earl Grey Tea",
          price: 3.5,
          category: "Tea",
          img: "https://i.ibb.co/Hf6ZhbZ/Earlgrey.jpg",
          description: "A classic black tea blend, fragrant with bergamot.",
          allergens: [],
          customizations: { temperature: ["Hot", "Cold"] },
        },
        {
          id: 13,
          name: "Chamomile Tea",
          price: 3.5,
          category: "Tea",
          img: "https://i.ibb.co/xtPyRd9/Chamomile.jpg",
          description: "A soothing herbal tea with a delicate, floral aroma.",
          allergens: [],
          customizations: { temperature: ["Hot", "Cold"] },
        },
        {
          id: 14,
          name: "Green Tea",
          price: 3.5,
          category: "Tea",
          img: "https://i.ibb.co/SDHkcTj/Greentea.jpg",
          description:
            "A refreshing and vibrant green tea full of antioxidants.",
          allergens: [],
          customizations: { temperature: ["Hot", "Cold"] },
        },
        // Seasonal Drinks
        {
          id: 15,
          name: "Fresh Lemonade",
          price: 4.5,
          category: "Seasonal",
          img: "https://i.ibb.co/Kcjj58b/Lemonade.jpg",
          description:
            "Made in-house with freshly squeezed lemons. Perfectly sweet and tart.",
          allergens: [],
        },
        {
          id: 16,
          name: "Matcha Latte",
          price: 5.75,
          category: "Seasonal",
          img: "https://i.ibb.co/gZsZj1T/latte.jpg",
          description: "Earthy ceremonial grade matcha, lightly sweetened.",
          allergens: ["Dairy"],
          customizations: { temperature: ["Hot", "Cold"] },
        },
        {
          id: 17,
          name: "Strawberry Acai",
          price: 5.5,
          category: "Seasonal",
          img: "https://i.ibb.co/4RJF4wm/Strawberryacai.jpg",
          description:
            "A vibrant and fruity refresher with notes of strawberry and acai.",
          allergens: [],
        },
        // Breakfast
        {
          id: 18,
          name: "Bacon, Egg & Cheese",
          price: 8.5,
          category: "Breakfast",
          img: "https://i.ibb.co/kgc9xzr/BEC.jpg",
          description:
            "Crispy bacon, fluffy egg, and melted cheese on a fresh brioche bun.",
          allergens: ["Wheat", "Dairy", "Eggs"],
          customizations: { toast: ["Untoasted", "Toasted"] },
        },
        {
          id: 19,
          name: "Avocado Toast",
          price: 9.5,
          category: "Breakfast",
          img: "https://i.ibb.co/cKzs0GN/AvocadoT.jpg",
          description:
            "Smashed avocado on our signature sourdough, topped with everything seasoning.",
          allergens: ["Wheat", "Sesame"],
          customizations: {
            toppings: [
              {
                name: "Add Bacon",
                price: 2.0,
                img: "https://i.ibb.co/hxBK09R/Bacon-Avocado.jpg",
              },
            ],
          },
        },
        // Lunch
        {
          id: 20,
          name: "Turkey & Swiss",
          price: 12.0,
          category: "Lunch",
          img: "https://i.ibb.co/JRBSS1c/Turk-Swiss.jpg",
          description:
            "Roasted turkey, Swiss cheese, lettuce, and tomato on sourdough.",
          allergens: ["Wheat", "Dairy"],
          customizations: {
            toast: ["Untoasted", "Toasted"],
            toppings: [
              { name: "Add Bacon", price: 1.5 },
              { name: "Add Avocado", price: 2.5 },
            ],
          },
        },
        {
          id: 21,
          name: "Caprese Sandwich",
          price: 11.5,
          category: "Lunch",
          img: "https://i.ibb.co/Fqw9f19/Caprese.jpg",
          description:
            "Fresh mozzarella, ripe tomatoes, basil, and balsamic glaze on focaccia.",
          allergens: ["Wheat", "Dairy"],
          customizations: { toast: ["Untoasted", "Toasted"] },
        },
        // Pizza
        {
          id: 22,
          name: "Margherita Pizza",
          price: 21.0,
          category: "Pizza",
          img: "https://i.ibb.co/G4SQQ4w/Margherita.jpg",
          description:
            "Classic pizza with fresh mozzarella, San Marzano tomatoes, and basil.",
          allergens: ["Wheat", "Dairy"],
        },
        {
          id: 23,
          name: "Classic Pizza",
          price: 14.0,
          category: "Pizza",
          img: "https://placehold.co/400x400/d3d3d3/ffffff?text=Classic+Pizza",
          description: "A simple cheese pizza. Add pepperoni for $2.00.",
          allergens: ["Wheat", "Dairy"],
          customizations: { toppings: [{ name: "Add Pepperoni", price: 2.0 }] },
        },
        {
          id: 24,
          name: "Spicy Brooklyn Pizza",
          price: 24.0,
          category: "Pizza",
          img: "https://i.ibb.co/cSDF23Q/Spicy-Brooklyn.jpg",
          description:
            "Tomato sauce, mozzarella, pepperoni, pickled long hots, and hot honey.",
          allergens: ["Wheat", "Dairy"],
        },
      ];

      // --- STATE ---
      let cartItems = [];
      const NJ_SALES_TAX_RATE = 0.06625;
      let selectedPickupDay = "today";
      let selectedPickupTime = "";
      let currentFilter = "All";
      let tipInfo = { type: "percent", value: 0 };
      const storeHours = { open: 7, close: 17 };
      let toastTimer;

      // --- DOM ELEMENTS ---
      const menuGrid = document.getElementById("menu-grid");
      const filterContainer = document.getElementById("filter-container");
      const searchBar = document.getElementById("search-bar");
      const cartElement = document.getElementById("cart");
      const floatingCartBtn = document.getElementById("floating-cart-btn");
      const cartItemCount = document.getElementById("cart-item-count");
      const toastWrapper = document.getElementById("toast-wrapper");
      const toastMessage = document.getElementById("toast-message");
      const modal = document.getElementById("custom-modal");
      const mobileMenuButton = document.getElementById("mobile-menu-button");
      const mobileMenu = document.getElementById("mobile-menu");

      // --- HELPER FUNCTIONS ---
      function calculateAndRoundPickupTime() {
        const now = new Date();
        const earliestPickup = new Date(now.getTime() + 15 * 60000);
        const minutes = earliestPickup.getMinutes();
        const remainder = minutes % 15;
        if (remainder !== 0) {
          earliestPickup.setMinutes(
            earliestPickup.getMinutes() + (15 - remainder),
          );
        }
        earliestPickup.setSeconds(0, 0);
        return earliestPickup;
      }

      function generateTimeSlotButtons(day, showAll = false) {
        const timeSlotContainer = document.getElementById(
          "time-slot-container",
        );
        const laterButtonContainer = document.getElementById(
          "later-button-container",
        );
        if (!timeSlotContainer) return;
        timeSlotContainer.innerHTML = "";
        if (laterButtonContainer) laterButtonContainer.innerHTML = "";

        let startHour, startMinute;
        if (day === "today") {
          const earliestTime = calculateAndRoundPickupTime();
          startHour = earliestTime.getHours();
          startMinute = earliestTime.getMinutes();
          if (startHour >= storeHours.close) {
            timeSlotContainer.innerHTML =
              '<p class="text-center text-gray-500 col-span-full">Sorry, ordering for today is closed.</p>';
            return;
          }
          if (startHour < storeHours.open) {
            startHour = storeHours.open;
            startMinute = 0;
          }
        } else {
          // tomorrow
          startHour = storeHours.open;
          startMinute = 0;
        }

        let slotsGenerated = 0,
          moreSlotsAvailable = false;
        const maxInitialSlots = 3;

        const nowButton = document.createElement("button");
        nowButton.className =
          "time-slot-btn bg-white border-2 border-amber-600 text-amber-800 px-4 py-2 rounded-full font-semibold touch-target";
        nowButton.textContent = "ASAP";
        nowButton.dataset.time = "ASAP";
        timeSlotContainer.appendChild(nowButton);
        slotsGenerated++;

        for (let hour = startHour; hour < storeHours.close; hour++) {
          for (
            let minute = hour === startHour ? startMinute : 0;
            minute < 60;
            minute += 15
          ) {
            if (!showAll && slotsGenerated >= maxInitialSlots) {
              moreSlotsAvailable = true;
              break;
            }
            const timeString = `${hour % 12 === 0 ? 12 : hour % 12}:${minute.toString().padStart(2, "0")} ${hour < 12 ? "AM" : "PM"}`;
            const button = document.createElement("button");
            button.className =
              "time-slot-btn bg-white border-2 border-amber-600 text-amber-800 px-4 py-2 rounded-full font-semibold touch-target";
            button.textContent = timeString;
            button.dataset.time = timeString;
            timeSlotContainer.appendChild(button);
            slotsGenerated++;
          }
          if (
            !showAll &&
            slotsGenerated >= maxInitialSlots &&
            moreSlotsAvailable
          )
            break;
        }

        if (moreSlotsAvailable && !showAll && laterButtonContainer) {
          const laterButton = document.createElement("button");
          laterButton.className =
            "show-later-btn text-amber-800 hover:underline font-semibold touch-target";
          laterButton.textContent = "Show more times";
          laterButtonContainer.appendChild(laterButton);
        }
      }

      function renderMenuFilters() {
        const categories = [
          "All",
          ...new Set(menuItems.map((item) => item.category)),
        ];
        filterContainer.innerHTML = "";
        categories.forEach((category) => {
          const button = document.createElement("button");
          button.className = `filter-btn px-4 py-2 border-2 rounded-full font-semibold whitespace-nowrap touch-target ${currentFilter === category ? "selected" : "border-amber-600 text-amber-800"}`;
          button.textContent = category;
          button.dataset.category = category;
          filterContainer.appendChild(button);
        });
      }

      function renderMenuItems(items = menuItems) {
        menuGrid.innerHTML = "";

        if (currentFilter === "All") {
          // Group items by category and display with section headers
          const categoryOrder = [
            "Pastries",
            "Breads",
            "Coffee",
            "Sweets",
            "Tea",
            "Seasonal",
            "Breakfast",
            "Lunch",
            "Pizza",
          ];
          const filteredItems = items;

          categoryOrder.forEach((category) => {
            const categoryItems = filteredItems.filter(
              (item) => item.category === category,
            );
            if (categoryItems.length === 0) return;

            // Create category header
            const categoryHeader = document.createElement("div");
            categoryHeader.className = "col-span-full mb-4 mt-8 first:mt-0";
            categoryHeader.innerHTML = `
                    <h3 class="text-2xl sm:text-3xl font-bold font-display text-amber-800 mb-4 text-center">${category}</h3>
                    <div class="w-16 h-1 bg-amber-800 mx-auto mb-6"></div>
                `;
            menuGrid.appendChild(categoryHeader);

            // Add items for this category
            categoryItems.forEach((item) => {
              const card = createMenuItemCard(item);
              menuGrid.appendChild(card);
            });
          });
        } else {
          // Show filtered items without category headers
          const filteredItems = items.filter(
            (item) => item.category === currentFilter,
          );
          filteredItems.forEach((item) => {
            const card = createMenuItemCard(item);
            menuGrid.appendChild(card);
          });
        }
      }

      function createMenuItemCard(item) {
        const card = document.createElement("div");
        card.className =
          "bg-white rounded-lg shadow-lg overflow-hidden transform hover:scale-105 transition-transform";

        let customizationOptions = "";
        if (item.customizations) {
          if (item.customizations.toast) {
            customizationOptions += `
                    <div class="flex gap-2 mt-2">
                        ${item.customizations.toast
                          .map(
                            (option) =>
                              `<button class="custom-btn px-3 py-1 border border-amber-600 text-amber-800 rounded-full text-sm touch-target" data-type="toast" data-value="${option}">${option}</button>`,
                          )
                          .join("")}
                    </div>
                `;
          }
          if (item.customizations.temperature) {
            customizationOptions += `
                    <div class="flex gap-2 mt-2">
                        ${item.customizations.temperature
                          .map(
                            (option) =>
                              `<button class="custom-btn px-3 py-1 border border-amber-600 text-amber-800 rounded-full text-sm touch-target" data-type="temperature" data-value="${option}">${option}</button>`,
                          )
                          .join("")}
                    </div>
                `;
          }
          if (item.customizations.slice) {
            customizationOptions += `
                        <div class="flex gap-2 mt-2">
                            ${item.customizations.slice
                              .map(
                                (option, index) =>
                                  `<button class="custom-btn px-3 py-1 border border-amber-600 text-amber-800 rounded-full text-sm touch-target ${index === 0 ? "selected" : ""}" data-type="slice" data-value="${option.name}">${option.name} ($${(item.price + option.price).toFixed(2)})</button>`,
                              )
                              .join("")}
                        </div>
                    `;
          }
        }

        const quantityButtons = `
            <div class="flex items-center gap-3 mt-4">
                <button class="quantity-change bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center font-bold touch-target" data-item-id="${item.id}" data-change="-1">-</button>
                <input type="number" id="quantity-${item.id}" value="1" min="1" max="25" class="w-16 text-center border rounded py-1">
                <button class="quantity-change bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center font-bold touch-target" data-item-id="${item.id}" data-change="1">+</button>
                ${
                  item.customizations && item.customizations.toppings
                    ? `<button class="customize-btn bg-gray-200 text-gray-800 font-bold py-2 px-3 rounded-full hover:bg-gray-300 transition touch-target text-sm" data-item-id="${item.id}">Customize</button>`
                    : ""
                }
            </div>
        `;

        card.innerHTML = `
            <img src="${item.img}" alt="${item.name}" class="menu-item-img w-full h-48 sm:h-56">
            <div class="p-4 sm:p-6">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-lg sm:text-xl font-display">${item.name}</h3>
                    <span id="price-${item.id}" class="text-lg sm:text-xl font-bold text-amber-800">$${item.price.toFixed(2)}</span>
                </div>
                <p class="text-gray-600 text-sm sm:text-base mb-3">${item.description}</p>
                ${customizationOptions}
                ${quantityButtons}
                <div class="flex gap-2 mt-4">
                    <button class="add-to-cart-btn flex-1 bg-amber-800 text-white font-bold py-2 px-4 rounded-full hover:bg-amber-900 transition touch-target" data-item-id="${item.id}">Add to Cart</button>
                    <button class="allergens-btn bg-blue-100 text-blue-800 px-3 py-2 rounded-full text-sm hover:bg-blue-200 transition touch-target" data-item-id="${item.id}">Allergens</button>
                </div>
            </div>
        `;

        return card;
      }

      function renderCart() {
        updateFloatingCartButton();

        if (cartItems.length === 0) {
          cartElement.innerHTML = `
                <div class="flex items-center justify-between p-4 sm:p-6 border-b bg-white">
                    <h2 class="text-xl sm:text-2xl font-bold font-display">Your Cart</h2>
                    <button id="close-cart" class="text-gray-500 hover:text-gray-700 touch-target">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div class="flex-1 flex items-center justify-center p-6 bg-white">
                    <div class="text-center">
                        <i data-lucide="shopping-cart" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                        <p class="text-gray-500 text-lg">Your cart is empty</p>
                        <p class="text-gray-400 text-sm mt-2">Add some delicious items to get started!</p>
                    </div>
                </div>
            `;
          lucide.createIcons();
          return;
        }

        const header = document.createElement("div");
        header.className =
          "flex items-center justify-between p-4 sm:p-6 border-b bg-white";
        header.innerHTML = `
            <h2 class="text-xl sm:text-2xl font-bold font-display">Your Cart</h2>
            <button id="close-cart" class="text-gray-500 hover:text-gray-700 touch-target">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        `;

        const itemsContainer = document.createElement("div");
        itemsContainer.className = "flex-1 overflow-y-auto bg-gray-50";

        const itemsList = document.createElement("div");
        itemsList.className = "p-4 sm:p-6 space-y-4";

        cartItems.forEach((cartItem) => {
          const menuItem = menuItems.find((item) => item.id === cartItem.id);
          if (!menuItem) return;

          const itemDiv = document.createElement("div");
          itemDiv.className =
            "flex gap-4 bg-white p-4 rounded-lg shadow-sm border";

          let customizationText = "";
          if (cartItem.customizations) {
            const customs = [];
            Object.entries(cartItem.customizations).forEach(([key, value]) => {
              if (
                key === "toppings" &&
                Array.isArray(value) &&
                value.length > 0
              ) {
                customs.push(value.join(", "));
              } else if (value && key !== "toppings") {
                customs.push(value);
              }
            });
            if (customs.length > 0) {
              customizationText = `<p class="text-sm text-gray-600">${customs.join(", ")}</p>`;
            }
          }

          itemDiv.innerHTML = `
                <img src="${menuItem.img}" alt="${menuItem.name}" class="w-16 h-16 sm:w-20 sm:h-20 object-cover rounded">
                <div class="flex-1">
                    <h4 class="font-semibold text-sm sm:text-base">${menuItem.name}</h4>
                    ${customizationText}
                    <p class="text-amber-800 font-bold text-sm sm:text-base">$${cartItem.price.toFixed(2)} each</p>
                    <div class="flex items-center justify-between mt-2">
                        <div class="flex items-center gap-2">
                            <button class="cart-quantity-change bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm touch-target" data-unique-id="${cartItem.uniqueId}" data-change="-1">-</button>
                            <span class="w-8 text-center font-semibold">${cartItem.quantity}</span>
                            <button class="cart-quantity-change bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm touch-target" data-unique-id="${cartItem.uniqueId}" data-change="1">+</button>
                        </div>
                        <button class="cart-remove-item text-red-600 hover:text-red-800 text-sm touch-target" data-unique-id="${cartItem.uniqueId}">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                <div class="text-right">
                    <p class="font-bold text-amber-800 text-sm sm:text-base">$${(cartItem.price * cartItem.quantity).toFixed(2)}</p>
                </div>
            `;

          itemsList.appendChild(itemDiv);
        });

        itemsContainer.appendChild(itemsList);

        const footer = document.createElement("div");
        footer.id = "cart-footer";
        footer.className = "border-t bg-white";

        updateCartTotals();

        footer.innerHTML = `
            <div id="checkout-view" class="p-4 sm:p-6">
                <div class="space-y-3 mb-6">
                    <div class="flex justify-between text-sm sm:text-base">
                        <span>Subtotal:</span>
                        <span id="cart-subtotal">$0.00</span>
                    </div>
                    <div class="flex justify-between text-sm sm:text-base">
                        <span>Tax:</span>
                        <span id="cart-tax">$0.00</span>
                    </div>
                    <div class="flex justify-between text-sm sm:text-base">
                        <span>Tip:</span>
                        <span id="cart-tip">$0.00</span>
                    </div>
                    <div class="flex justify-between font-bold text-lg border-t pt-2">
                        <span>Total:</span>
                        <span id="cart-total">$0.00</span>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="font-bold font-display text-lg mb-3">Pickup or Delivery?</h4>
                    <div class="flex gap-2 mb-4">
                        <button class="pickup-btn flex-1 bg-amber-800 text-white font-bold py-2 px-4 rounded-full hover:bg-amber-900 transition touch-target">Pickup</button>
                        <button class="delivery-btn flex-1 bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-full hover:bg-gray-300 transition touch-target">Delivery</button>
                    </div>

                    <div id="pickup-options" class="">
                        <div class="mb-4">
                            <h5 class="font-semibold mb-2">Pickup Day:</h5>
                            <div class="flex gap-2">
                                <button class="date-btn bg-amber-800 text-white px-4 py-2 rounded-full font-semibold touch-target" data-day="today">Today</button>
                                <button class="date-btn bg-white border-2 border-amber-600 text-amber-800 px-4 py-2 rounded-full font-semibold touch-target" data-day="tomorrow">Tomorrow</button>
                            </div>
                        </div>
                        <div class="mb-4">
                            <h5 class="font-semibold mb-2">Pickup Time:</h5>
                            <div id="time-slot-container" class="flex flex-wrap gap-2 mb-2">
                                <!-- Time slots will be generated by JS -->
                            </div>
                            <div id="later-button-container" class="text-center">
                                <!-- "Show more times" button will be added here if needed -->
                            </div>
                        </div>
                    </div>

                    <div id="delivery-options" class="hidden">
                        <p class="text-gray-600 text-sm">Delivery is not yet available. Please select pickup.</p>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="font-bold font-display text-lg mb-3">Add a Tip</h4>
                    <div class="flex flex-wrap gap-2 mb-3">
                        <button class="tip-btn bg-white border-2 border-amber-600 text-amber-800 px-4 py-2 rounded-full font-semibold touch-target" data-tip="15">15%</button>
                        <button class="tip-btn bg-white border-2 border-amber-600 text-amber-800 px-4 py-2 rounded-full font-semibold touch-target" data-tip="18">18%</button>
                        <button class="tip-btn bg-white border-2 border-amber-600 text-amber-800 px-4 py-2 rounded-full font-semibold touch-target" data-tip="20">20%</button>
                        <button class="tip-btn bg-white border-2 border-amber-600 text-amber-800 px-4 py-2 rounded-full font-semibold touch-target" data-tip="custom">Custom</button>
                    </div>
                    <div id="custom-tip-container" class="hidden">
                        <input type="number" id="custom-tip-input" placeholder="Enter tip %" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600" min="0" max="100">
                    </div>
                </div>

                <button class="checkout-continue-btn w-full bg-green-600 text-white font-bold py-3 px-6 rounded-full hover:bg-green-700 transition text-lg touch-target">Continue to Payment</button>
            </div>

            <div id="payment-view" class="hidden p-4 sm:p-6">
                <h4 class="font-bold font-display text-xl mb-4">Select Payment</h4>
                <div class="space-y-3 mb-6">
                    <button class="payment-btn w-full flex items-center justify-center p-3 border rounded-lg hover:bg-gray-100 touch-target">
                        <i data-lucide="credit-card" class="mr-2"></i> Debit/Credit Card
                    </button>
                    <button class="payment-btn w-full flex items-center justify-center p-3 border rounded-lg hover:bg-gray-100 touch-target">
                        <i data-lucide="smartphone" class="mr-2"></i> Apple/Google Pay
                    </button>
                </div>
                <button class="back-to-checkout-btn w-full text-sm text-gray-600 hover:underline touch-target">Back to Order Options</button>
            </div>
        `;

        cartElement.innerHTML = "";
        cartElement.appendChild(header);
        cartElement.appendChild(itemsContainer);
        cartElement.appendChild(footer);

        generateTimeSlotButtons(selectedPickupDay);
        updateCartTotals();
        lucide.createIcons();
      }

      function updateCartTotals() {
        const subtotalElement = document.getElementById("cart-subtotal");
        const taxElement = document.getElementById("cart-tax");
        const tipElement = document.getElementById("cart-tip");
        const totalElement = document.getElementById("cart-total");

        if (!subtotalElement) return;

        const subtotal = cartItems.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0,
        );
        const tax = subtotal * NJ_SALES_TAX_RATE;
        const tip =
          tipInfo.type === "percent"
            ? (subtotal * tipInfo.value) / 100
            : tipInfo.value;
        const total = subtotal + tax + tip;

        subtotalElement.textContent = `$${subtotal.toFixed(2)}`;
        taxElement.textContent = `$${tax.toFixed(2)}`;
        tipElement.textContent = `$${tip.toFixed(2)}`;
        totalElement.textContent = `$${total.toFixed(2)}`;
      }

      function updateFloatingCartButton() {
        const totalQuantity = cartItems.reduce(
          (sum, item) => sum + item.quantity,
          0,
        );
        if (totalQuantity > 0) {
          cartItemCount.textContent = totalQuantity;
          floatingCartBtn.classList.add("visible");
        } else {
          floatingCartBtn.classList.remove("visible");
        }
      }

      function showToast(message) {
        clearTimeout(toastTimer);
        toastMessage.textContent = message;
        toastWrapper.classList.add("visible");
        toastTimer = setTimeout(() => {
          toastWrapper.classList.remove("visible");
        }, 3000);
      }

      function showModal(
        title,
        body,
        actions = '<button class="modal-close-btn bg-amber-800 text-white font-bold py-2 px-8 rounded-full touch-target">OK</button>',
      ) {
        document.getElementById("modal-title").textContent = title;
        document.getElementById("modal-body").innerHTML = body;
        document.getElementById("modal-actions").innerHTML = actions;
        modal.classList.remove("hidden");
      }

      function hideModal() {
        modal.classList.add("hidden");
      }

      // --- EVENT HANDLERS & LOGIC ---
      function addToCart(item, quantity, customizations) {
        let price = item.price;
        if (customizations.toppings) {
          customizations.toppings.forEach((toppingName) => {
            const topping = item.customizations.toppings.find(
              (t) => t.name === toppingName,
            );
            if (topping) price += topping.price;
          });
        }
        if (customizations.slice === "Slice") {
          const sliceOption = item.customizations.slice.find(
            (s) => s.name === "Slice",
          );
          if (sliceOption) price += sliceOption.price;
        }

        showToast("Item added to your cart!");
        const uniqueId = `${item.id}-${JSON.stringify(customizations)}`;
        const existingItem = cartItems.find(
          (cartItem) => cartItem.uniqueId === uniqueId,
        );
        if (existingItem) {
          existingItem.quantity += quantity;
        } else {
          cartItems.push({
            id: item.id,
            uniqueId,
            quantity,
            customizations,
            price,
          });
        }
        renderCart();
      }

      // Mobile menu toggle
      mobileMenuButton.addEventListener("click", () => {
        mobileMenu.classList.toggle("mobile-menu-hidden");
        mobileMenu.classList.toggle("mobile-menu-visible");
      });

      // Close mobile menu when clicking on a link
      mobileMenu.addEventListener("click", (e) => {
        if (e.target.tagName === "A") {
          mobileMenu.classList.add("mobile-menu-hidden");
          mobileMenu.classList.remove("mobile-menu-visible");
        }
      });

      menuGrid.addEventListener("click", (e) => {
        const button = e.target.closest("button");
        if (!button) return;

        const card = e.target.closest(".bg-white");

        if (button.classList.contains("quantity-change")) {
          const itemId = parseInt(button.dataset.itemId);
          const change = parseInt(button.dataset.change);
          const input = document.getElementById(`quantity-${itemId}`);
          let currentValue = parseInt(input.value);
          currentValue = Math.max(1, Math.min(25, currentValue + change));
          input.value = currentValue;
        } else if (button.classList.contains("add-to-cart-btn")) {
          const itemId = parseInt(button.dataset.itemId);
          const item = menuItems.find((i) => i.id === itemId);
          const quantity = parseInt(
            document.getElementById(`quantity-${itemId}`).value,
          );
          const customizations = { toppings: [] };

          card.querySelectorAll(".custom-btn.selected").forEach((btn) => {
            customizations[btn.dataset.type] = btn.dataset.value;
          });

          const cardImage = card.querySelector(".menu-item-img");
          if (
            customizations.toppings &&
            customizations.toppings.includes("Add Bacon") &&
            item.customizations &&
            item.customizations.toppings &&
            item.customizations.toppings[0].img
          ) {
            cardImage.src = item.customizations.toppings[0].img;
          }

          addToCart(item, quantity, customizations);
        } else if (button.classList.contains("custom-btn")) {
          const type = button.dataset.type;
          const value = button.dataset.value;
          const parent = button.parentElement;
          parent
            .querySelectorAll(`.custom-btn[data-type="${type}"]`)
            .forEach((btn) => btn.classList.remove("selected"));
          button.classList.add("selected");

          // Update price display for slice customization
          if (type === "slice") {
            const itemId = parseInt(
              card.querySelector(".add-to-cart-btn").dataset.itemId,
            );
            const item = menuItems.find((i) => i.id === itemId);
            const priceElement = document.getElementById(`price-${itemId}`);

            if (
              item &&
              item.customizations &&
              item.customizations.slice &&
              priceElement
            ) {
              const sliceOption = item.customizations.slice.find(
                (option) => option.name === value,
              );
              if (sliceOption) {
                const newPrice = item.price + sliceOption.price;
                priceElement.textContent = `$${newPrice.toFixed(2)}`;
              }
            }
          }
        } else if (button.classList.contains("allergens-btn")) {
          const item = menuItems.find((i) => i.id == button.dataset.itemId);
          const allergensList =
            item.allergens.length > 0
              ? item.allergens.join(", ")
              : "No common allergens listed.";
          showModal(
            "Allergen Information",
            `Contains: ${allergensList}`,
            '<button class="modal-close-btn bg-amber-800 text-white font-bold py-2 px-8 rounded-full touch-target">OK</button>',
          );
        } else if (button.classList.contains("customize-btn")) {
          const item = menuItems.find((i) => i.id == button.dataset.itemId);
          let modalBody = '<div class="space-y-2 text-left">';
          if (item.customizations && item.customizations.toppings) {
            item.customizations.toppings.forEach((topping) => {
              modalBody += `<label class="flex items-center space-x-3">
                                        <input type="checkbox" class="topping-checkbox h-5 w-5 rounded border-gray-300 text-amber-600 focus:ring-amber-500" data-name="${topping.name}" data-price="${topping.price}">
                                        <span>${topping.name} (+$${topping.price.toFixed(2)})</span>
                                     </label>`;
            });
          }
          modalBody += "</div>";
          const actions = `<button class="modal-close-btn bg-gray-500 text-white font-bold py-2 px-6 rounded-full touch-target">Cancel</button>
                                 <button id="save-customizations-btn" data-item-id="${item.id}" class="bg-amber-800 text-white font-bold py-2 px-6 rounded-full touch-target">Add to Cart</button>`;
          showModal(`Customize ${item.name}`, modalBody, actions);
        }
      });

      modal.addEventListener("click", (e) => {
        if (e.target.classList.contains("modal-close-btn")) {
          hideModal();
        } else if (e.target.id === "save-customizations-btn") {
          const itemId = parseInt(e.target.dataset.itemId);
          const item = menuItems.find((i) => i.id === itemId);
          const quantity = 1;
          const customizations = { toppings: [] };

          document
            .querySelectorAll(".topping-checkbox:checked")
            .forEach((checkbox) => {
              customizations.toppings.push(checkbox.dataset.name);
            });

          addToCart(item, quantity, customizations);
          hideModal();
        }
      });

      cartElement.addEventListener("click", (e) => {
        const button = e.target.closest("button");
        if (!button) return;

        if (button.closest("#close-cart")) {
          cartElement.classList.add("cart-hidden");
        } else if (button.classList.contains("cart-quantity-change")) {
          const uniqueId = button.dataset.uniqueId;
          const change = parseInt(button.dataset.change);
          const itemInCart = cartItems.find(
            (item) => item.uniqueId === uniqueId,
          );
          if (itemInCart) {
            itemInCart.quantity += change;
            if (itemInCart.quantity <= 0) {
              cartItems = cartItems.filter(
                (item) => item.uniqueId !== uniqueId,
              );
            }
          }
          renderCart();
        } else if (button.classList.contains("cart-remove-item")) {
          const uniqueId = button.dataset.uniqueId;
          cartItems = cartItems.filter((item) => item.uniqueId !== uniqueId);
          renderCart();
        } else if (button.classList.contains("delivery-btn")) {
          document
            .getElementById("delivery-options")
            .classList.remove("hidden");
          document.getElementById("pickup-options").classList.add("hidden");
          document
            .querySelectorAll(".delivery-btn, .pickup-btn")
            .forEach((btn) => {
              btn.classList.remove("bg-amber-800", "text-white");
              btn.classList.add("bg-gray-200", "text-gray-800");
            });
          button.classList.remove("bg-gray-200", "text-gray-800");
          button.classList.add("bg-amber-800", "text-white");
        } else if (button.classList.contains("pickup-btn")) {
          document.getElementById("delivery-options").classList.add("hidden");
          document.getElementById("pickup-options").classList.remove("hidden");
          document
            .querySelectorAll(".delivery-btn, .pickup-btn")
            .forEach((btn) => {
              btn.classList.remove("bg-amber-800", "text-white");
              btn.classList.add("bg-gray-200", "text-gray-800");
            });
          button.classList.remove("bg-gray-200", "text-gray-800");
          button.classList.add("bg-amber-800", "text-white");
        } else if (button.classList.contains("date-btn")) {
          selectedPickupDay = button.dataset.day;
          document.querySelectorAll(".date-btn").forEach((btn) => {
            btn.classList.remove("bg-amber-800", "text-white");
            btn.classList.add(
              "bg-white",
              "border-2",
              "border-amber-600",
              "text-amber-800",
            );
          });
          button.classList.add("bg-amber-800", "text-white");
          button.classList.remove(
            "bg-white",
            "border-2",
            "border-amber-600",
            "text-amber-800",
          );
          generateTimeSlotButtons(selectedPickupDay);
        } else if (button.classList.contains("time-slot-btn")) {
          document
            .querySelectorAll(".time-slot-btn")
            .forEach((btn) => btn.classList.remove("selected"));
          button.classList.add("selected");
          selectedPickupTime = button.dataset.time;
        } else if (button.classList.contains("show-later-btn")) {
          generateTimeSlotButtons(selectedPickupDay, true);
        } else if (button.classList.contains("tip-btn")) {
          const tipValue = button.dataset.tip;
          document
            .querySelectorAll(".tip-btn")
            .forEach((b) => b.classList.remove("selected"));
          button.classList.add("selected");
          const customTipContainer = document.getElementById(
            "custom-tip-container",
          );
          const customTipInput = document.getElementById("custom-tip-input");
          if (tipValue === "custom") {
            customTipContainer.classList.remove("hidden");
            tipInfo = {
              type: "percent",
              value: parseFloat(customTipInput.value) || 0,
              isCustom: true,
            };
          } else {
            customTipContainer.classList.add("hidden");
            customTipInput.value = "";
            tipInfo = {
              type: "percent",
              value: parseInt(tipValue),
              isCustom: false,
            };
          }
          updateCartTotals();
        } else if (button.classList.contains("checkout-continue-btn")) {
          const subtotal = cartItems.reduce(
            (sum, item) => sum + item.price * item.quantity,
            0,
          );
          if (subtotal > 150) {
            showModal(
              "Order Limit Exceeded",
              'Our max online order amount is $150 before taxes & tips. Please call us at <a href="tel:908-933-0123" class="text-amber-800 font-bold hover:underline">(908) 933-0123</a> to place a larger order.',
              '<button class="modal-close-btn bg-amber-800 text-white font-bold py-2 px-8 rounded-full touch-target">OK</button>',
            );
            return;
          }
          document.getElementById("checkout-view").classList.add("hidden");
          document.getElementById("payment-view").classList.remove("hidden");
        } else if (button.classList.contains("back-to-checkout-btn")) {
          document.getElementById("checkout-view").classList.remove("hidden");
          document.getElementById("payment-view").classList.add("hidden");
        } else if (button.classList.contains("payment-btn")) {
          showModal(
            "Online Ordering",
            "Our full online ordering system is launching soon! Please call us or visit in person to place an order.",
            '<button class="modal-close-btn bg-amber-800 text-white font-bold py-2 px-8 rounded-full touch-target">OK</button>',
          );
        }
      });

      cartElement.addEventListener("input", (e) => {
        if (e.target.id === "custom-tip-input") {
          const value = parseFloat(e.target.value) || 0;
          tipInfo = {
            type: "percent",
            value: value >= 5 ? value : 0,
            isCustom: true,
          };
          updateCartTotals();
        }
      });

      filterContainer.addEventListener("click", (e) => {
        if (e.target.classList.contains("filter-btn")) {
          currentFilter = e.target.dataset.category;
          document
            .querySelectorAll(".filter-btn")
            .forEach((btn) => btn.classList.remove("selected"));
          e.target.classList.add("selected");
          renderMenuItems();
        }
      });

      searchBar.addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const filteredItems = menuItems.filter(
          (item) =>
            item.name.toLowerCase().includes(searchTerm) ||
            item.description.toLowerCase().includes(searchTerm) ||
            item.category.toLowerCase().includes(searchTerm),
        );
        renderMenuItems(filteredItems);
      });

      floatingCartBtn.addEventListener("click", () => {
        cartElement.classList.remove("cart-hidden");
      });

      document
        .getElementById("catering-form")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          showModal(
            "Thank You!",
            "Your catering inquiry has been submitted. We'll be in touch with you soon!",
            '<button class="modal-close-btn bg-amber-800 text-white font-bold py-2 px-8 rounded-full touch-target">OK</button>',
          );
          e.target.reset();
        });

      // --- INITIALIZATION ---
      renderMenuFilters();
      renderMenuItems();
      renderCart();
      lucide.createIcons();
    </script>
  </body>
</html>
